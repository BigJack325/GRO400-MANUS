sudo: required

services:
  - docker
  
before_script:
  - sudo apt-get --yes --no-install-recommends install binfmt-support qemu-user-static
  - echo ':arm:M::\x7fELF\x01\x01\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00\x02\x00\x28\x00:\xff\xff\xff\xff\xff\xff\xff\x00\xff\xff\xff\xff\xff\xff\xff\xff\xfe\xff\xff\xff:/usr/bin/qemu-arm-static:' | sudo tee -a /proc/sys/fs/binfmt_misc/register
  - docker pull sedden/rpi-raspbian-qemu:wheezy



jobs:
  include:
  - stage: Qt
    name: "Qt"

    
    script:
      - bash Qt/Hexapod_Qt/install_venv_pi.sh
      - docker build -t Qt/test Qt
      - docker run -it Qt/test uname -a
      - docker run -it Qt/test go version
      - docker run -it Qt/test make check
      
  - stage: Arduino
    name: "Arduino"
    
    language: python
    python:
      - "3.6"

    cache:
      directories:
        - "~/.platformio"

    env:
      - PLATFORMIO_CI_SRC=Hexapod-master/Hexapod_Arduino


    install:
      - pip install -U platformio

    script:
      - platformio run -d $PLATFORMIO_CI_SRC

      - docker build -t Qt/test Qt
      - docker run -it Qt/test uname -a
      - docker run -it Qt/test go version
      - docker run -it Qt/test make check
